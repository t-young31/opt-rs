use std::collections::HashSet;
use crate::coordinates::Point;
use crate::ff::forcefield::EnergyFunction;

/// Dihedral angle
///
///     E_i  --- E_j
///                 \  φ
///                  \
///                   E_k ---- E_l
///
#[derive(Debug)]

pub struct TorsionalDihedral{

    pub(crate) i:  usize,
    pub(crate) j:  usize,
    pub(crate) k:  usize,
    pub(crate) l:  usize,

    pub(crate) phi0:  f64,
    pub(crate) n_phi: f64,
    pub(crate) v_phi: f64
}

impl TorsionalDihedral {

    #[inline(always)]
    fn half_v_phi(&self) -> f64{ self.v_phi/2.0 }
}


impl EnergyFunction for TorsionalDihedral {
    fn involves_idxs(&self, idxs: Vec<usize>) -> bool {
        HashSet::from([self.i, self.j, self.k, self.l]) == HashSet::from_iter(idxs)
    }

    fn force_constant(&self) -> f64 {
        self.v_phi
    }

    /// E = V/2 (1 - cos(n φ_0)cos(n φ))
    fn energy(&self, coordinates: &Vec<Point>) -> f64 {

        let phi = phi(self, coordinates);
        self.half_v_phi() * (1. - (self.n_phi * self.phi0).cos()*(self.n_phi * phi).cos())
    }

    fn add_gradient(&self,
                    coordinates:      &Vec<Point>,
                    gradient: &mut Vec<Point>) {

        let x_i = coordinates[self.i].x;
        let y_i = coordinates[self.i].y;
        let z_i = coordinates[self.i].z;

        let x_j = coordinates[self.j].x;
        let y_j = coordinates[self.j].y;
        let z_j = coordinates[self.j].z;

        let x_k = coordinates[self.k].x;
        let y_k = coordinates[self.k].y;
        let z_k = coordinates[self.k].z;

        let x_l = coordinates[self.l].x;
        let y_l = coordinates[self.l].y;
        let z_l = coordinates[self.l].z;

        gradient[self.i].x += 0.5*self.n_phi*self.v_phi*((-((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())*((-y_j + y_k)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (z_j - z_k)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-2.*y_j + 2.*y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_j - 2.*z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*(-(-2.*y_j + 2.*y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_j - 2.*z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*(-(-2.*y_j + 2.*y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_j - 2.*z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)) + (((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(z_j - z_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(-2.*y_j + 2.*y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_j - 2.*z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*(-(-2.*y_j + 2.*y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_j - 2.*z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*(-y_j + y_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*(-(-2.*y_j + 2.*y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_j - 2.*z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*(-(-2.*y_j + 2.*y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_j - 2.*z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k).powi(2)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*(-(-2.*y_j + 2.*y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_j - 2.*z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + (-z_j + z_k)*(z_j - z_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(-2.*y_j + 2.*y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_j - 2.*z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)))*(self.n_phi*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).atan2( ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))).sin()*(self.n_phi*self.phi0).cos();
        gradient[self.i].y += 0.5*self.n_phi*self.v_phi*((-((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())*((x_j - x_k)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-z_j + z_k)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(2.*x_j - 2.*x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_j + 2.*z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*(-(2.*x_j - 2.*x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_j + 2.*z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(2.*x_j - 2.*x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_j + 2.*z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)) + (((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(2.*x_j - 2.*x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_j + 2.*z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + (-y_j + y_k)*(-z_j + z_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*(-(2.*x_j - 2.*x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_j + 2.*z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*(x_j - x_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*(-(2.*x_j - 2.*x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_j + 2.*z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) - (-z_j + z_k).powi(2)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*(-(2.*x_j - 2.*x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_j + 2.*z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(x_j - x_k)*(-y_j + y_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*(-(2.*x_j - 2.*x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_j + 2.*z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(2.*x_j - 2.*x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_j + 2.*z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)))*(self.n_phi*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).atan2( ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))).sin()*(self.n_phi*self.phi0).cos();
        gradient[self.i].z += 0.5*self.n_phi*self.v_phi*((-((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())*((-x_j + x_k)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (y_j - y_k)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*(-(-2.*x_j + 2.*x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (2.*y_j - 2.*y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(-2.*x_j + 2.*x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (2.*y_j - 2.*y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(-2.*x_j + 2.*x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (2.*y_j - 2.*y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)) + (((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k).powi(2)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(-2.*x_j + 2.*x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (2.*y_j - 2.*y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + (-y_j + y_k)*(y_j - y_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*(-(-2.*x_j + 2.*x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (2.*y_j - 2.*y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*(-(-2.*x_j + 2.*x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (2.*y_j - 2.*y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) - (y_j - y_k)*(-z_j + z_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*(-(-2.*x_j + 2.*x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (2.*y_j - 2.*y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*((-x_j + x_k)*(-z_j + z_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*(-(-2.*x_j + 2.*x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (2.*y_j - 2.*y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(-2.*x_j + 2.*x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (2.*y_j - 2.*y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)))*(self.n_phi*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).atan2( ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))).sin()*(self.n_phi*self.phi0).cos();
        gradient[self.j].x += 0.5*self.n_phi*self.v_phi*((-((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())*((y_i - y_k)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-y_k + y_l)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-z_i + z_k)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (z_k - z_l)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(2.*y_i - 2.*y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_i + 2.*z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-2.*y_k + 2.*y_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (2.*z_k - 2.*z_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*(-(2.*y_i - 2.*y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_i + 2.*z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*(-(-2.*y_k + 2.*y_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (2.*z_k - 2.*z_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*(-(2.*y_i - 2.*y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_i + 2.*z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-2.*y_k + 2.*y_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (2.*z_k - 2.*z_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)))/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))*((-y_k + y_l)*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (z_k - z_l)*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-2.*y_k + 2.*y_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (2.*z_k - 2.*z_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2.)*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + ((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k).powi(2)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-x_j + x_k)*(-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-x_j + x_k)*(-z_i + z_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(2.*y_i - 2.*y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_i + 2.*z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*(-(2.*y_i - 2.*y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_i + 2.*z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*(-(-2.*y_k + 2.*y_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (2.*z_k - 2.*z_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2.)*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k).powi(2)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-x_j + x_k)*(y_i - y_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-x_j + x_k)*(-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*(-(2.*y_i - 2.*y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_i + 2.*z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*(-(2.*y_i - 2.*y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_i + 2.*z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) - ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-2.*y_k + 2.*y_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (2.*z_k - 2.*z_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2.)*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-x_j + x_k)*(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-x_j + x_k)*(-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (y_i - y_k)*(-y_j + y_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*(-(2.*y_i - 2.*y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_i + 2.*z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + (-z_i + z_k)*(-z_j + z_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(2.*y_i - 2.*y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_i + 2.*z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)))*(self.n_phi*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).atan2( ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))).sin()*(self.n_phi*self.phi0).cos();
        gradient[self.j].y += 0.5*self.n_phi*self.v_phi*((-((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())*((-x_i + x_k)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (x_k - x_l)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (z_i - z_k)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-z_k + z_l)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(-2.*x_i + 2.*x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_i - 2.*z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(-2.*x_i + 2.*x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_i - 2.*z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(-2.*x_i + 2.*x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_i - 2.*z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(2.*x_k - 2.*x_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (-2.*z_k + 2.*z_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*(-(2.*x_k - 2.*x_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (-2.*z_k + 2.*z_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)) + (-(2.*x_k - 2.*x_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (-2.*z_k + 2.*z_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)))/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))*((x_k - x_l)*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-z_k + z_l)*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(2.*x_k - 2.*x_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (-2.*z_k + 2.*z_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + ((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-y_j + y_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-x_j + x_k)*(-(-2.*x_i + 2.*x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_i - 2.*z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + (-y_j + y_k).powi(2)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*(z_i - z_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*(-(-2.*x_i + 2.*x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_i - 2.*z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) - ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*(-(2.*x_k - 2.*x_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (-2.*z_k + 2.*z_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_i + x_k)*(-x_j + x_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-x_j + x_k)*(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-x_j + x_k)*(-(-2.*x_i + 2.*x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_i - 2.*z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) - (-y_j + y_k)*(-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (z_i - z_k)*(-z_j + z_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*(-(-2.*x_i + 2.*x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_i - 2.*z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(2.*x_k - 2.*x_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (-2.*z_k + 2.*z_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-x_i + x_k)*(-y_j + y_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-y_j + y_k).powi(2)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*(-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-y_j + y_k)*(-(-2.*x_i + 2.*x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_i - 2.*z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + (-z_j + z_k)*(-(-2.*x_i + 2.*x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_i - 2.*z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)))*(self.n_phi*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).atan2( ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))).sin()*(self.n_phi*self.phi0).cos();
        gradient[self.j].z += 0.5*self.n_phi*self.v_phi*((-((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())*((x_i - x_k)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-x_k + x_l)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-y_i + y_k)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (y_k - y_l)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*(-(2.*x_i - 2.*x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (-2.*y_i + 2.*y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-2.*x_k + 2.*x_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2. - (2.*y_k - 2.*y_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(2.*x_i - 2.*x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (-2.*y_i + 2.*y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*(-(-2.*x_k + 2.*x_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2. - (2.*y_k - 2.*y_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)) + (-(2.*x_i - 2.*x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (-2.*y_i + 2.*y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(-2.*x_k + 2.*x_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2. - (2.*y_k - 2.*y_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)))/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))*((-x_k + x_l)*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (y_k - y_l)*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-2.*x_k + 2.*x_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2. - (2.*y_k - 2.*y_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + ((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(x_i - x_k)*(-x_j + x_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-x_j + x_k)*(-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(2.*x_i - 2.*x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (-2.*y_i + 2.*y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + (-y_i + y_k)*(-y_j + y_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*(-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*(-(2.*x_i - 2.*x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (-2.*y_i + 2.*y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*(-(-2.*x_k + 2.*x_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2. - (2.*y_k - 2.*y_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*(-z_j + z_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*(-(2.*x_i - 2.*x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (-2.*y_i + 2.*y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) - (-y_i + y_k)*(-z_j + z_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k).powi(2)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*(-(2.*x_i - 2.*x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (-2.*y_i + 2.*y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(-2.*x_k + 2.*x_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2. - (2.*y_k - 2.*y_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*((x_i - x_k)*(-z_j + z_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-y_j + y_k)*(-z_j + z_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*(-(2.*x_i - 2.*x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (-2.*y_i + 2.*y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + (-z_j + z_k).powi(2)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(2.*x_i - 2.*x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (-2.*y_i + 2.*y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) - (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)))*(self.n_phi*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).atan2( ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))).sin()*(self.n_phi*self.phi0).cos();
        gradient[self.k].x += 0.5*self.n_phi*self.v_phi*((-((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())*((-y_i + y_j)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (y_j - y_l)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (z_i - z_j)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-z_j + z_l)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-2.*y_i + 2.*y_j)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_i - 2.*z_j)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(2.*y_j - 2.*y_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (-2.*z_j + 2.*z_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*(-(-2.*y_i + 2.*y_j)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_i - 2.*z_j)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*(-(2.*y_j - 2.*y_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (-2.*z_j + 2.*z_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)) + (-(-2.*y_i + 2.*y_j)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_i - 2.*z_j)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(2.*y_j - 2.*y_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (-2.*z_j + 2.*z_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)))/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))*((y_j - y_l)*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-z_j + z_l)*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(2.*y_j - 2.*y_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (-2.*z_j + 2.*z_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2.)*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + ((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(x_j - x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-x_j + x_k)*(z_i - z_j)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(-2.*y_i + 2.*y_j)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_i - 2.*z_j)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + (x_j - x_k)*(-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*(-(-2.*y_i + 2.*y_j)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_i - 2.*z_j)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) - (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*(-(2.*y_j - 2.*y_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (-2.*z_j + 2.*z_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2.)*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*(x_j - x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-x_j + x_k)*(-y_i + y_j)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*(-(-2.*y_i + 2.*y_j)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_i - 2.*z_j)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) - (x_j - x_k)*(-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*(-(-2.*y_i + 2.*y_j)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_i - 2.*z_j)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(2.*y_j - 2.*y_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (-2.*z_j + 2.*z_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2.)*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(x_j - x_k)*(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (x_j - x_k)*(-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-y_i + y_j)*(-y_j + y_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*(-(-2.*y_i + 2.*y_j)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_i - 2.*z_j)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + (z_i - z_j)*(-z_j + z_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(-2.*y_i + 2.*y_j)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (2.*z_i - 2.*z_j)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)))*(self.n_phi*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).atan2( ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))).sin()*(self.n_phi*self.phi0).cos();
        gradient[self.k].y += 0.5*self.n_phi*self.v_phi*((-((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())*((x_i - x_j)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-x_j + x_l)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-z_i + z_j)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (z_j - z_l)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*(-(2.*x_i - 2.*x_j)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_i + 2.*z_j)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*(-(-2.*x_j + 2.*x_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (2.*z_j - 2.*z_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(2.*x_i - 2.*x_j)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_i + 2.*z_j)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(-2.*x_j + 2.*x_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (2.*z_j - 2.*z_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)) + (-(2.*x_i - 2.*x_j)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_i + 2.*z_j)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(-2.*x_j + 2.*x_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (2.*z_j - 2.*z_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)))/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))*((-x_j + x_l)*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (z_j - z_l)*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(-2.*x_j + 2.*x_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (2.*z_j - 2.*z_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + (-(-2.*x_j + 2.*x_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (2.*z_j - 2.*z_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + (-(-2.*x_j + 2.*x_l)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (2.*z_j - 2.*z_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + ((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(y_j - y_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(2.*x_i - 2.*x_j)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_i + 2.*z_j)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + (-y_j + y_k)*(y_j - y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*(-z_i + z_j)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*(-(2.*x_i - 2.*x_j)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_i + 2.*z_j)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((x_i - x_j)*(-x_j + x_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-x_j + x_k)*(y_j - y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*(-(2.*x_i - 2.*x_j)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_i + 2.*z_j)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) - (y_j - y_k)*(-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_i + z_j)*(-z_j + z_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*(-(2.*x_i - 2.*x_j)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_i + 2.*z_j)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(x_i - x_j)*(-y_j + y_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-y_j + y_k)*(y_j - y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*(-(2.*x_i - 2.*x_j)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_i + 2.*z_j)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + (y_j - y_k)*(-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(2.*x_i - 2.*x_j)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/2. - (-2.*z_i + 2.*z_j)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) - ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)))*(self.n_phi*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).atan2( ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))).sin()*(self.n_phi*self.phi0).cos();
        gradient[self.k].z += 0.5*self.n_phi*self.v_phi*((-((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())*((-x_i + x_j)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (x_j - x_l)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (y_i - y_j)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-y_j + y_l)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(-2.*x_i + 2.*x_j)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (2.*y_i - 2.*y_j)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(-2.*x_i + 2.*x_j)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (2.*y_i - 2.*y_j)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(-2.*x_i + 2.*x_j)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (2.*y_i - 2.*y_j)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(2.*x_j - 2.*x_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2. - (-2.*y_j + 2.*y_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*(-(2.*x_j - 2.*x_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2. - (-2.*y_j + 2.*y_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)) + (-(2.*x_j - 2.*x_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2. - (-2.*y_j + 2.*y_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)))/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))*((x_j - x_l)*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-y_j + y_l)*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(2.*x_j - 2.*x_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2. - (-2.*y_j + 2.*y_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + ((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_i + x_j)*(-x_j + x_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-x_j + x_k)*(z_j - z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-x_j + x_k)*(-(-2.*x_i + 2.*x_j)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (2.*y_i - 2.*y_j)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + (y_i - y_j)*(-y_j + y_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*(z_j - z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*(-(-2.*x_i + 2.*x_j)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (2.*y_i - 2.*y_j)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*(-(2.*x_j - 2.*x_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2. - (-2.*y_j + 2.*y_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*(z_j - z_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-x_j + x_k)*(-(-2.*x_i + 2.*x_j)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (2.*y_i - 2.*y_j)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) - (y_i - y_j)*(-z_j + z_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*(z_j - z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*(-(-2.*x_i + 2.*x_j)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (2.*y_i - 2.*y_j)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) - ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(2.*x_j - 2.*x_l)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2. - (-2.*y_j + 2.*y_l)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*((-x_i + x_j)*(-z_j + z_k)/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-y_j + y_k)*(z_j - z_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-y_j + y_k)*(-(-2.*x_i + 2.*x_j)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (2.*y_i - 2.*y_j)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + (-z_j + z_k)*(z_j - z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).powf(1.5)*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(-2.*x_i + 2.*x_j)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/2. - (2.*y_i - 2.*y_j)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/2.)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).powf(1.5)) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)))*(self.n_phi*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).atan2( ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))).sin()*(self.n_phi*self.phi0).cos();
        gradient[self.l].x += 0.5*self.n_phi*self.v_phi*((-((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())*((-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (z_j - z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-2.*y_j + 2.*y_k)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (2.*z_j - 2.*z_k)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*(-(-2.*y_j + 2.*y_k)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (2.*z_j - 2.*z_k)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*(-(-2.*y_j + 2.*y_k)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (2.*z_j - 2.*z_k)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2.)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)))/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))*((-y_j + y_k)*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (z_j - z_k)*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-2.*y_j + 2.*y_k)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (2.*z_j - 2.*z_k)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2.)*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*(-(-2.*y_j + 2.*y_k)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (2.*z_j - 2.*z_k)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2.)*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + (-(-2.*y_j + 2.*y_k)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (2.*z_j - 2.*z_k)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2.)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5))/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)))*(self.n_phi*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).atan2( ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))).sin()*(self.n_phi*self.phi0).cos();
        gradient[self.l].y += 0.5*self.n_phi*self.v_phi*((-((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())*((x_j - x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(2.*x_j - 2.*x_k)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (-2.*z_j + 2.*z_k)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*(-(2.*x_j - 2.*x_k)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (-2.*z_j + 2.*z_k)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)) + (-(2.*x_j - 2.*x_k)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (-2.*z_j + 2.*z_k)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)))/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))*((x_j - x_k)*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-z_j + z_k)*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(2.*x_j - 2.*x_k)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (-2.*z_j + 2.*z_k)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*(-(2.*x_j - 2.*x_k)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (-2.*z_j + 2.*z_k)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + (-(2.*x_j - 2.*x_k)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/2. - (-2.*z_j + 2.*z_k)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5))/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)))*(self.n_phi*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).atan2( ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))).sin()*(self.n_phi*self.phi0).cos();
        gradient[self.l].z += 0.5*self.n_phi*self.v_phi*((-((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() - ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())*((-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (y_j - y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*(-(-2.*x_j + 2.*x_k)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2. - (2.*y_j - 2.*y_k)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(-2.*x_j + 2.*x_k)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2. - (2.*y_j - 2.*y_k)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)) + (-(-2.*x_j + 2.*x_k)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2. - (2.*y_j - 2.*y_k)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5)))/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))*((-x_j + x_k)*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (y_j - y_k)*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(-2.*x_j + 2.*x_k)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2. - (2.*y_j - 2.*y_k)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + (-(-2.*x_j + 2.*x_k)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2. - (2.*y_j - 2.*y_k)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5) + (-(-2.*x_j + 2.*x_k)*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/2. - (2.*y_j - 2.*y_k)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/2.)*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).powf(1.5))/((((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).powi(2) + (((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt())).powi(2)))*(self.n_phi*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))*(-(-x_j + x_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-y_j + y_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))*((-x_j + x_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) - (-z_j + z_k)*((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt() + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))*(-(-y_j + y_k)*((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()) + (-z_j + z_k)*(-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))/(((-x_j + x_k).powi(2) + (-y_j + y_k).powi(2) + (-z_j + z_k).powi(2)).sqrt()*(((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()))/(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()).atan2( ((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j))*((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j))*(-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j))*((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k))/((((x_i - x_j)*(-y_j + y_k) - (-x_j + x_k)*(y_i - y_j)).powi(2) + (-(x_i - x_j)*(-z_j + z_k) + (-x_j + x_k)*(z_i - z_j)).powi(2) + ((y_i - y_j)*(-z_j + z_k) - (-y_j + y_k)*(z_i - z_j)).powi(2)).sqrt()*(((x_j - x_k)*(-y_k + y_l) - (-x_k + x_l)*(y_j - y_k)).powi(2) + (-(x_j - x_k)*(-z_k + z_l) + (-x_k + x_l)*(z_j - z_k)).powi(2) + ((y_j - y_k)*(-z_k + z_l) - (-y_k + y_l)*(z_j - z_k)).powi(2)).sqrt()))).sin()*(self.n_phi*self.phi0).cos();
    }
}


/// Value of the dihedral
fn phi(dihedral: &TorsionalDihedral, coordinates: &Vec<Point>) -> f64{

    let r_ij = &coordinates[dihedral.i] - &coordinates[dihedral.j];
    let r_lk = &coordinates[dihedral.l] - &coordinates[dihedral.k];
    let mut r_kj = &coordinates[dihedral.k] - &coordinates[dihedral.j];

    let mut v0 = r_ij.cross(&r_kj);
    v0.divide_by(v0.length());

    let mut v1 = (-r_kj.clone()).cross(&r_lk);

    v1.divide_by(v1.length());
    r_kj.divide_by(r_kj.length());

    -(v0.cross(&r_kj).dot(&v1)).atan2(v0.dot(&v1))
}


/*
   /$$                           /$$
  | $$                          | $$
 /$$$$$$    /$$$$$$   /$$$$$$$ /$$$$$$   /$$$$$$$
|_  $$_/   /$$__  $$ /$$_____/|_  $$_/  /$$_____/
  | $$    | $$$$$$$$|  $$$$$$   | $$   |  $$$$$$
  | $$ /$$| $$_____/ \____  $$  | $$ /$$\____  $$
  |  $$$$/|  $$$$$$$ /$$$$$$$/  |  $$$$//$$$$$$$/
   \___/   \_______/|_______/    \___/ |_______/
 */

#[cfg(test)]
mod tests{

    use super::*;
    use crate::utils::*;

    /// Ensure a torsion can be calculated correctly. Compared to an Avogadro reference
    #[test]
    fn test_torsional_dihedral_calculation(){

        // Coordinates for a H2O2 molecule
        let x: Vec<Point> = Vec::from([
            Point{x: -3.80272, y: 0.11331, z: -0.29090},
            Point{x: -3.75673, y: 1.06948, z: -0.03303},
            Point{x: -2.46930, y: 1.33955, z:  0.03004},
            Point{x: -2.25240, y: 1.31540, z:  0.99712}
        ]);
        let dihedral = TorsionalDihedral{i: 0, j: 1, k: 2, l: 3, n_phi: 0., phi0: 0., v_phi: 0.};

        let expected_phi = -1.7593;  // -100.8 degrees

        assert!(is_close(phi(&dihedral, &x), expected_phi, 1E-3));
    }

}
